{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap da58e03e0d89f9ef869d","webpack:///./src/CanvasViewer.js","webpack:///external \"angular\"","webpack:///./src/FormatReader.js"],"names":["module","directive","$window","$http","$timeout","$q","formatReader","scope","imageSource","overlays","title","options","restrict","template","link","iElm","iAttrs","controller","canvasEl","find","ctx","getContext","inNode","element","directiveParentNode","parentNode","canvasSize","canvas","width","clientWidth","height","clientHeight","resize","img","curPos","x","y","picPos","mousePos","reader","merge","adsrc","zoom","value","step","min","max","scrollStep","rotate","controls","toolbar","image","sound","fit","disableZoom","disableMove","disableRotate","numPage","totalPage","filmStrip","info","onload","rendered","applyTransform","resizeTo","$watch","undefined","IsSupported","type","decoder","CreateReader","create","console","log","newarr","oldarr","forEach","item","push","position","refresh","bind","$event","event","delta","Math","wheelDelta","detail","images","length","$applyAsync","returnValue","preventDefault","centerX","centerY","clearRect","save","translate","PI","isZoom","scale","drawImage","beginPath","rect","lineWidth","strokeStyle","stroke","data","putImageData","offsetY","restore","w","h","fillStyle","color","globalAlpha","fill","canMove","offsetX","coordX","coordY","translateX","translateY","getMousePositionBasedOnImage","container","direction","oldWidth","newWidth","oldHeight","newHeight","oldwidth","mousePosition","centerPics","picPosX","picPosY","ratioH","ratioW","defaultSize","windowMinSize","contentMinSize","round","play","start","stop","resizeCanvas","parentChange","name","FormatReader","mimetype","PDFJS","disableWorker","Tiff","audioTest","AudioContext","webkitAudioContext","mozAudioContext","msAudioContext","ex","prototype","pdfReader","callback","FileReader","that","context","_pdfDoc","viewport","Image","oldheight","page","currentPage","rendering","triggerRefresh","renderPage","parent","pageNum","pageObj","document","createElement","abs","getViewport","render","canvasContext","intent","then","getImageData","sort","objA","objB","p","promises","getPage","all","pages","pageIndex","Uint8Array","result","getDocument","numPages","getMetadata","metadata","readAsArrayBuffer","tiffReader","tiff","buffer","countDirectory","compression","getField","Tag","COMPRESSION","DOCUMENTNAME","description","IMAGEDESCRIPTION","orientation","ORIENTATION","xresolution","XRESOLUTION","yresolution","YRESOLUTION","setDirectory","src","toDataURL","close","initialize","TOTAL_MEMORY","imageReader","readAsDataURL","mpegReader","wavReader","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","msRequestAnimationFrame","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","msCancelAnimationFrame","adctx","decodeAudioData","gradient","createLinearGradient","addColorStop","javascriptNode","createScriptProcessor","source","createBufferSource","analyser","createAnalyser","smoothingTimeConstant","fftSize","connect","onaudioprocess","array","frequencyBinCount","getByteFrequencyData","i","fillRect","destination","e","mimeType","obj","GuessMimeType","toLowerCase","indexOf","fileName","substring"],"mappings":"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","file":"angular-canvas-viewer.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"angular\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"angular\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"angular-canvas-viewer\"] = factory(require(\"angular\"));\n\telse\n\t\troot[\"angular-canvas-viewer\"] = factory(root[\"angular\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_2__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap da58e03e0d89f9ef869d","import angular from 'angular'\nimport FormatReader from './FormatReader'\n\nexport default angular.module('canvasViewer', [])\n  .directive('canvasViewer', ['$window', '$http', '$timeout', '$q',\n    function ($window, $http, $timeout, $q) {\n      var formatReader = new FormatReader();\n\n      return {\n        // name: '',\n        // terminal: true,\n        scope: {\n          imageSource: '=src',\n          overlays: '=overlays',\n          title: '@title',\n          options: '=options'\n        }, // {} = isolate, true = child, false/undefined = no change\n        // require: 'ngModel', // Array = multiple requires, ? = optional, ^ = check parent elements\n        restrict: 'E',\n        template: `\n    <div class=\"viewer-container\">\n      <canvas class=\"viewer\" ng-mouseleave=\"canMove=false\" ng-mousedown=\"mousedown($event)\" ng-mouseup=\"mouseup($event)\" ng-init=\"canMove=false\"\n        ng-mousemove=\"mousedrag($event,canMove)\">\n      </canvas>\n      <div class=\"title\" ng-if=\"title!=null\">{{title}}</div>\n      <div class=\"command\" ng-if=\"options.controls.image\">\n        <button class=\"btn btn-info\" ng-click=\"options.controls.numPage=options.controls.numPage-1\" ng-hide=\"options.controls.totalPage==1\"\n          title=\"Previous Page\"><i class=\"fa fa-minus\"></i></button>\n          <button class=\"btn btn-info\" ng-hide=\"options.controls.totalPage==1\">{{options.controls.numPage}}/{{options.controls.totalPage}}</button>\n          <button class=\"btn btn-info\" ng-click=\"options.controls.numPage=options.controls.numPage+1\" ng-hide=\"options.controls.totalPage==1\"\n            title=\"Next Page\"><i class=\"fa fa-plus\"></i></button>\n            <button class=\"btn btn-info\" ng-click=\"resizeTo('page')\" title=\"Fit to page\"><i class=\"fa fa-file-o\"></i></button>\n            <button class=\"btn btn-info\" ng-click=\"rotate(-1)\" ng-hide=\"options.controls.disableRotate\" title=\"Rotate left\"><i class=\"fa fa-rotate-left\"></i></button>\n            <button class=\"btn btn-info\" ng-click=\"rotate(1)\" ng-hide=\"options.controls.disableRotate\" title=\"Rotate right\"><i class=\"fa fa-rotate-right\"></i></button>\n            <button class=\"btn btn-info\" ng-click=\"zoom(-1)\" ng-hide=\"options.controls.disableZoom\" title=\"Zoom out\"><i class=\"fa fa-search-minus\"></i></button>\n            <button class=\"btn btn-info\" ng-click=\"zoom(1)\" ng-hide=\"options.controls.disableZoom\" title=\"Zoom in\"><i class=\"fa fa-search-plus\"></i></button>\n      </div>\n      <div class=\"command\" ng-if=\"options.controls.sound\">\n        <button class=\"btn btn-info\" ng-click=\"stop()\" title=\"Stop\"><i class=\"fa fa-stop\"></i></button>\n        <button class=\"btn btn-info\" ng-click=\"play()\" title=\"Play\"><i class=\"fa fa-play\"></i></button>\n      </div>\n    </div>\n    `,\n        // replace: true,\n        // transclude: true,\n        // compile: function(tElement, tAttrs, function transclude(function(scope, cloneLinkingFn){ return function linking(scope, elm, attrs){}})),\n        link: function (scope, iElm, iAttrs, controller) {\n          var canvasEl = iElm.find('canvas')[0];\n          var ctx = canvasEl.getContext('2d');\n          // look for\n          var inNode = angular.element(iElm.find('div')[0])[0];\n          var directiveParentNode = inNode.parentNode.parentNode;\n          // orce correct canvas size\n          var canvasSize = canvasEl.parentNode;\n          ctx.canvas.width = canvasSize.clientWidth;\n          ctx.canvas.height = canvasSize.clientHeight;\n          var resize = { height: canvasSize.clientHeight, width: canvasSize.clientWidth };\n          // initialize variable\n          var img = null;\n          var curPos = { x: 0, y: 0 };\n          var picPos = { x: 0, y: 0 };\n          var mousePos = { x: 0, y: 0 };\n          var overlays = [];\n          var reader = null;\n\n          // Merge scope with default values\n          scope.options = angular.merge({}, {\n            ctx: null,\n            adsrc: null,\n            zoom: {\n              value: 1.0,\n              step: 0.1,\n              min: 0.05,\n              max: 6,\n              scrollStep: 0.01\n            },\n            rotate: {\n              value: 0,\n              step: 90\n            },\n            controls: {\n              toolbar: true,\n              image: true,\n              sound: false,\n              fit: 'page',\n              disableZoom: false,\n              disableMove: false,\n              disableRotate: false,\n              numPage: 1,\n              totalPage: 1,\n              filmStrip: false\n            },\n            info: {}\n          }, scope.options);\n\n          scope.options.ctx = ctx;\n\n          function onload() {\n            if (reader == null) {\n              return;\n            }\n\n            if (reader.rendered) {\n              applyTransform();\n            } else {\n              scope.resizeTo(scope.options.controls.fit);\n            }\n          }\n\n          scope.$watch('imageSource', function (value) {\n            if (value === undefined || value === null)\n              return;\n            // initialize values on load\n            scope.options.zoom.value = 1.0;\n            scope.options.rotate.value = 0;\n            curPos = { x: 0, y: 0 };\n            picPos = { x: 0, y: 0 };\n\n            // test if object or string is input of directive\n            if (typeof (value) === 'object') {\n              // Object type file\n              if (formatReader.IsSupported(value.type)) {\n                // get object\n                var decoder = formatReader.CreateReader(value.type, value);\n                // Create image\n                reader = decoder.create(value, scope.options, onload, $q, $timeout, ctx);\n              } else {\n                console.log(value.type, ' not supported !');\n              }\n            } else if (typeof (value) === 'string') {\n              reader = formatReader.CreateReader(\"image/jpeg\").create(value, scope.options, onload, $q, $timeout);\n            }\n          });\n\n          scope.$watch('overlays', function (newarr, oldarr) {\n            // initialize new overlay\n            if (newarr === null || oldarr === null)\n              return;\n\n            // new added\n            overlays = [];\n            angular.forEach(newarr, function (item) {\n              overlays.push(item);\n            });\n\n            applyTransform();\n          }, true);\n\n          scope.$watch('options.zoom.value', function () {\n            if (!scope.options.controls.disableZoom) {\n              applyTransform();\n            }\n          });\n\n          scope.$watch('options.rotate.value', function () {\n            if (!scope.options.controls.disableRotate) {\n              applyTransform();\n            }\n          });\n\n          scope.$watch('options.controls.fit', function (value) {\n            scope.resizeTo(value);\n          });\n\n          scope.$watch('options.controls.filmStrip', function (position) {\n\n            if (position) {\n              scope.options.controls.disableMove = true;\n              scope.options.controls.disableRotate = true;\n            } else {\n              scope.options.controls.disableMove = false;\n              scope.options.controls.disableRotate = false;\n            }\n            if (reader.refresh != null) {\n              reader.refresh();\n            }\n          });\n\n          scope.$watch('options.controls.numPage', function (value) {\n            // Limit page navigation\n            if (scope.options.controls.numPage < 1) scope.options.controls.numPage = 1;\n            if (scope.options.controls.numPage > scope.options.controls.totalPage) scope.options.controls.numPage = scope.options.controls.totalPage;\n            if (reader != null) {\n              if (scope.options.controls.filmStrip) {\n                // All pages are already rendered so go to correct page\n                picPos.y = (scope.options.controls.numPage - 1) * -(reader.height + 15);\n                applyTransform();\n              } else {\n                if (reader.refresh != null) {\n                  reader.refresh();\n                }\n              }\n            }\n          });\n\n          // Bind mousewheel\n          angular.element(canvasEl).bind(\"DOMMouseScroll mousewheel onmousewheel\", function ($event) {\n\n            // cross-browser wheel delta\n            var event = $window.event || $event; // old IE support\n            var delta = Math.max(-1, Math.min(1, (event.wheelDelta || -event.detail)));\n            if (scope.options.controls.filmStrip) {\n              picPos.y += 50 * delta;\n              // Limit range\n              if (picPos.y > 15) {\n                picPos.y = 15;\n              }\n              if (reader.images) {\n                if (picPos.y - reader.height * scope.options.zoom.value <\n                  -(reader.height + 15) * reader.images.length * scope.options.zoom.value) {\n                  picPos.y = -(reader.height + 15) * reader.images.length + reader.height;\n                }\n              } else {\n                if (picPos.y - reader.height * scope.options.zoom.value <\n                  -reader.height * scope.options.zoom.value) {\n                  picPos.y = -reader.height * scope.options.zoom.value;\n                }\n              }\n              //\n              scope.$applyAsync(function () {\n                applyTransform();\n              });\n            } else {\n              if (delta > 0) {\n                scope.zoom(1, event);\n              } else {\n                scope.zoom(-1, event);\n              }\n            }\n            // for IE\n            event.returnValue = false;\n            // for Chrome and Firefox\n            if (event.preventDefault) {\n              event.preventDefault();\n            }\n\n          });\n\n          function applyTransform() {\n            if (reader == null) {\n              return;\n            }\n            if (!reader.rendered) {\n              return;\n            }\n            var options = scope.options;\n            var canvas = ctx.canvas;\n            var centerX = reader.width * options.zoom.value / 2;\n            var centerY = reader.height * options.zoom.value / 2;\n            // Clean before draw\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            // Save context\n            ctx.save();\n            // move to mouse position\n            ctx.translate((picPos.x + centerX), (picPos.y + centerY));\n            // Rotate canvas\n            ctx.rotate(options.rotate.value * Math.PI / 180);\n            // Go back\n            ctx.translate(-centerX, -centerY);\n            // Change scale\n            if (reader.isZoom)\n              ctx.scale(options.zoom.value, options.zoom.value);\n            if ((!options.controls.filmStrip) || (options.controls.totalPage == 1)) {\n              if (reader.img != null) {\n                ctx.drawImage(reader.img, 0, 0, reader.width, reader.height);\n                ctx.beginPath();\n                ctx.rect(0, 0, reader.width, reader.height);\n                ctx.lineWidth = 0.2;\n                ctx.strokeStyle = \"#000000\";\n                ctx.stroke();\n              }\n              // Draw image at correct position with correct scale\n              if (reader.data != null) {\n                ctx.putImageData(reader.data, picPos.x, picPos.y);\n                ctx.beginPath();\n                ctx.rect(0, 0, reader.width, reader.height);\n                ctx.lineWidth = 0.2;\n                ctx.strokeStyle = \"#000000\";\n                ctx.stroke();\n              }\n            } else {\n              if (reader.images != null) {\n                angular.forEach(reader.images, function (image) {\n                  ctx.drawImage(image, 0, 0, image.width, image.height);\n                  ctx.beginPath();\n                  ctx.rect(0, 0, image.width, image.height);\n                  ctx.lineWidth = 0.2;\n                  ctx.strokeStyle = \"#000000\";\n                  ctx.stroke();\n                  ctx.translate(0, image.height + 15);\n                });\n              }\n              // Draw image at correct position with correct scale\n              if (reader.data != null) {\n                var offsetY = 0;\n                angular.forEach(reader.data, function (data) {\n                  ctx.putImageData(data, picPos.x, picPos.y + offsetY);\n                  ctx.beginPath();\n                  ctx.rect(0, 0, reader.width, reader.height);\n                  ctx.lineWidth = 0.2;\n                  ctx.strokeStyle = \"#000000\";\n                  ctx.stroke();\n                  offsetY += reader.height + 15;\n                  ctx.translate(0, offsetY);\n                });\n              }\n            }\n            // Restore\n            ctx.restore();\n\n            // Draw overlays\n            if (overlays.length > 0) {\n              angular.forEach(overlays, function (item) {\n                ctx.save();\n                // move to mouse position\n                ctx.translate((picPos.x + centerX), (picPos.y + centerY));\n                // Rotate canvas\n                ctx.rotate(options.rotate.value * Math.PI / 180);\n                // Go back\n                ctx.translate(-centerX, -centerY);\n                // Change scale\n                ctx.scale(options.zoom.value, options.zoom.value);\n                // Start rect draw\n                ctx.beginPath();\n                ctx.rect((item.x), (item.y), item.w, item.h);\n                ctx.fillStyle = item.color;\n                ctx.globalAlpha = 0.4;\n                ctx.fill();\n                ctx.lineWidth = 1;\n                ctx.strokeStyle = item.color;\n                ctx.stroke();\n                ctx.restore();\n              });\n            }\n          }\n\n          angular.element(canvasEl).bind('mousedown', function ($event) {\n            if (scope.options.controls.disableMove) {\n              return;\n            }\n\n            scope.canMove = true;\n            curPos.x = $event.offsetX;\n            curPos.y = $event.offsetY;\n          });\n\n          angular.element(canvasEl).bind('mouseup', function ($event) {\n            if (scope.options.controls.disableMove) {\n              return;\n            }\n\n            scope.canMove = false;\n          });\n\n          angular.element(canvasEl).bind('mousemove', function ($event) {\n            mousePos.x = $event.offsetX;\n            mousePos.y = $event.offsetY;\n            if (scope.options.controls.disableMove) {\n              return;\n            }\n\n            if ((reader !== null) && (scope.canMove)) {\n              var coordX = $event.offsetX;\n              var coordY = $event.offsetY;\n              var translateX = coordX - curPos.x;\n              var translateY = coordY - curPos.y;\n              picPos.x += translateX;\n              picPos.y += translateY;\n              applyTransform();\n              curPos.x = coordX;\n              curPos.y = coordY;\n            }\n          });\n\n          function getMousePositionBasedOnImage(event, container) {\n            if (!event) {\n              // triggered by click zoom-in and zoom-out buttons\n              return {\n                x: container.clientWidth / 2 - picPos.x,\n                y: container.clientHeight / 2 - picPos.y\n              };\n            }\n\n            return {\n              x: event.offsetX - picPos.x,\n              y: event.offsetY - picPos.y\n            };\n          }\n\n          scope.zoom = function (direction, event) {\n            scope.$applyAsync(function () {\n              var oldWidth, newWidth = 0;\n              var oldHeight, newHeight = 0;\n              // Does reader support zoom ?\n              // Compute correct width\n              if (!reader.isZoom) {\n                oldWidth = reader.oldwidth;\n                oldHeight = reader.height;\n              } else {\n                oldWidth = reader.width * scope.options.zoom.value;\n                oldHeight = reader.height * scope.options.zoom.value;\n              }\n\n              // Compute new zoom\n              var step = event ? scope.options.zoom.scrollStep : scope.options.zoom.step;\n              scope.options.zoom.value += step * direction * scope.options.zoom.value;\n\n              if (scope.options.zoom.value >= scope.options.zoom.max) {\n                scope.options.zoom.value = scope.options.zoom.max;\n              }\n              if (scope.options.zoom.value <= scope.options.zoom.min) {\n                scope.options.zoom.value = scope.options.zoom.min;\n              }\n              // Refresh picture\n              if (reader.refresh != null) {\n                reader.refresh();\n              }\n\n              // Compute new image size\n              if (!reader.isZoom) {\n                newWidth = reader.width;\n                newHeight = reader.height;\n              } else {\n                newWidth = reader.width * scope.options.zoom.value;\n                newHeight = reader.height * scope.options.zoom.value;\n              }\n\n              // new image position after zoom\n              var mousePosition = getMousePositionBasedOnImage(event, ctx.canvas);\n              picPos.x = picPos.x - (newWidth - oldWidth) * (mousePosition.x / oldWidth);\n              picPos.y = picPos.y - (newHeight - oldHeight) * (mousePosition.y / oldHeight);\n            });\n          }\n\n          scope.rotate = function (direction) {\n            scope.$applyAsync(function () {\n              scope.options.rotate.value += scope.options.rotate.step * direction;\n              if ((scope.options.rotate.value <= -360) || (scope.options.rotate.value >= 360)) {\n                scope.options.rotate.value = 0;\n              }\n              applyTransform();\n            });\n          };\n\n          var centerPics = function () {\n            // Position to canvas center\n            var centerX = ctx.canvas.width / 2;\n            var picPosX = 0;\n            var centerY = ctx.canvas.height / 2;\n            var picPosY = 0;\n\n            picPosX = centerX - (reader.width * scope.options.zoom.value) / 2;\n            picPosY = centerY - (reader.height * scope.options.zoom.value) / 2;\n            curPos = { x: picPosX, y: picPosY };\n            picPos = { x: picPosX, y: picPosY };\n          }\n\n          scope.resizeTo = function (value) {\n            if ((ctx.canvas == null) || (reader == null)) {\n              return;\n            }\n            // Compute page ratio\n            var options = scope.options;\n            var ratioH = ctx.canvas.height / reader.height;\n            var ratioW = ctx.canvas.width / reader.width;\n            // If reader render zoom itself\n            // Precompute from its ratio\n            if (!reader.isZoom) {\n              ratioH *= scope.options.zoom.value;\n              ratioW *= scope.options.zoom.value;\n            }\n            // Adjust value\n            var defaultSize = function () {\n              var windowMinSize = Math.min(ctx.canvas.height, ctx.canvas.width);\n              var contentMinSize = Math.min(reader.height, reader.width);\n              return (windowMinSize < contentMinSize) ? Math.min(ratioH, ratioW) : 1;\n            };\n\n            switch (value) {\n              case 'width':\n                scope.options.zoom.value = ratioW;\n                break;\n              case 'height':\n                scope.options.zoom.value = ratioH;\n                break;\n              case 'page':\n              default:\n                scope.options.zoom.value = defaultSize();\n            }\n            scope.$applyAsync(function () {\n              // Round zoom value\n              scope.options.zoom.value = Math.round(scope.options.zoom.value * 100) / 100;\n              // Update options state\n              scope.options.controls.fit = value;\n              if (!reader.isZoom) {\n                if (reader.refresh != null) {\n                  reader.refresh();\n                }\n\n                // Re center image\n                centerPics();\n              } else {\n                // Re center image\n                centerPics();\n                applyTransform();\n              }\n            });\n\n            // Rotate to default\n            scope.options.rotate.value = 0;\n          }\n\n          scope.play = function () {\n            if (scope.options.adsrc != null) {\n              scope.options.adsrc.start(0);\n            }\n          }\n\n          scope.stop = function () {\n            if (scope.options.adsrc != null) {\n              scope.options.adsrc.stop(0);\n            }\n          }\n\n          function resizeCanvas() {\n            scope.$applyAsync(function () {\n              var canvasSize = canvasEl.parentNode;\n              ctx.canvas.width = canvasSize.clientWidth;\n              ctx.canvas.height = canvasSize.clientHeight;\n              applyTransform();\n            });\n          }\n\n          // Keep object\n          function parentChange() {\n            if (resize.width != canvasEl.parentNode.clientWidth) {\n              resize.width = canvasEl.parentNode.clientWidth;\n            }\n\n            if (resize.height != canvasEl.parentNode.clientHeight) {\n              resize.height = canvasEl.parentNode.clientHeight;\n            }\n            return resize;\n          }\n\n          //\n          scope.$watch(parentChange, function () {\n            resizeCanvas();\n          }, true);\n          //      \t// resize canvas on window resize to keep aspect ratio\n          // angular.element($window).bind('resize', function() {\n          //  \tresizeCanvas();\n          // });\n        }\n      };\n    }]).name;\n\n\n// WEBPACK FOOTER //\n// ./src/CanvasViewer.js","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"angular\"\n// module id = 2\n// module chunks = 0","export default function FormatReader() {\r\n\tthis.mimetype = [\r\n\t\t\"image/png\",\r\n\t\t\"image/jpeg\"\r\n\t];\r\n\t// Test supported mime types\r\n\t// Is PDF module present\r\n\tif (typeof(PDFJS) !== \"undefined\") {\r\n\t\t// Remove it from list\r\n\t\tthis.mimetype.push(\"application/pdf\");\r\n\t\tPDFJS.disableWorker = false;\r\n\t}\r\n\t// Is Tiff module present\r\n\tif (typeof(Tiff) !== \"undefined\") {\r\n\t\t// Remove it from list\r\n\t\tthis.mimetype.push(\"image/tif\");\r\n\t\tthis.mimetype.push(\"image/tiff\");\r\n\t}\r\n\t// Test for audio support\r\n\ttry {\r\n\t\tvar audioTest = $window.AudioContext || $window.webkitAudioContext || $window.mozAudioContext || $window.msAudioContext;\r\n\t\tif (typeof(audioTest) !== \"undefined\") {\r\n\t\t\tthis.mimetype.push(\"audio/x-wav\");\r\n\t\t\tthis.mimetype.push(\"audio/wav\");\r\n\t\t\tthis.mimetype.push(\"audio/x-ogg\");\r\n\t\t\tthis.mimetype.push(\"audio/ogg\");\r\n\t\t\tthis.mimetype.push(\"audio/x-mpeg\");\r\n\t\t\tthis.mimetype.push(\"audio/mpeg\");\r\n\t\t}\r\n\t} catch(ex) {\r\n\r\n\t}\r\n}\r\n\r\nFormatReader.prototype = {\r\n\tpdfReader : function(data, options, callback, $q, $timeout, ctx) {\r\n\t\tif (options.controls.toolbar) {\r\n\t\t\toptions.controls.image = true;\r\n\t\t\toptions.controls.sound = false;\r\n\t\t}\r\n\t\tthis.reader = new FileReader();\r\n\t\t// read image object\r\n\t\tvar that = this;\r\n\t\tthat.context = ctx;\r\n\t\tthat.$q = $q;\r\n\t\tthat._pdfDoc = null;\r\n\t\tthat.viewport = null;\r\n\t\tthat.img = new Image();\r\n\t\tthat.rendered = false;\r\n\t\tthat.width = -1;\r\n\t\tthat.height = -1;\r\n\t\tthat.oldwidth = -1;\r\n\t\tthat.oldheight = -1;\r\n\t\tthat.data = null;\r\n\t\tthat.page = null;\r\n\t\tthat.options = options;\r\n\t\tthat.currentPage = -1;\r\n\t\tthat.rendering = false;\r\n\t\tthat.isZoom = false;\r\n\t\tthat.data = [];\r\n\t\tthat.triggerRefresh = false;\r\n\t\tfunction renderPage(parent, pageNum, pageObj) {\r\n\t\t\tif (pageNum == undefined) {\r\n\t\t\t\tpageNum = that.currentPage;\r\n\t\t\t}\r\n\r\n\t\t\tif (pageObj == undefined) {\r\n\t\t\t\tpageObj = parent.page;\r\n\t\t\t}\r\n\t\t\tvar canvas = document.createElement('canvas');\r\n\t\t\tvar context = canvas.getContext('2d');\r\n\t\t\tif ((pageObj != null)/* && !parent.rendering*/){\r\n\t\t\t\tparent.rendering = true;\r\n\t\t\t\tparent.oldwidth = parent.width;\r\n\t\t\t\tparent.oldheight = parent.height;\r\n\t\t\t\t// set viewport only on 1st page with filmstrip\r\n\t\t\t\tif (Math.abs(parent.options.zoom.value) == 0) parent.options.zoom.value = 1.0;\r\n\t\t\t\tvar viewport = pageObj.getViewport( parent.options.zoom.value, 0);\r\n\t\t\t\tcontext.canvas.width = viewport.width;\r\n\t\t\t\tcontext.canvas.height = viewport.height;\r\n\t\t\t\t// render to canvas\r\n\t\t\t\treturn pageObj.render({canvasContext : context, viewport : viewport, intent : 'display'}).then( function() {\r\n\t\t\t\t\t// restore canvas\r\n\t\t\t\t\t// var img = new Image();\r\n\t\t\t\t\t// img.onload = function() {\r\n\t\t\t\t\t// \tparent.width = img.width;\r\n\t\t\t\t\t// \tparent.height = img.height;\r\n\t\t\t\t\t// \tif (options.controls.filmStrip) {\r\n\t\t\t\t\t// \t\t// Add rendered image\r\n\t\t\t\t\t// \t\timg.pageNum = pageNum;\r\n\t\t\t\t\t// \t\tparent.images.push(img);\r\n\t\t\t\t\t// \t\tthat.img = img;\r\n\t\t\t\t\t// \t\tif (parent.images.length == options.controls.totalPage) {\r\n\t\t\t\t\t// \t\t\t// Do sorting of all pictures\r\n\t\t\t\t\t// \t\t\tparent.images.sort( function(objA, objB) {\r\n\t\t\t\t\t// \t\t\t\treturn objA.pageNum - objB.pageNum;\r\n\t\t\t\t\t// \t\t\t});\r\n\t\t\t\t\t// \t\t\t// Do drawing on rendering ended\r\n\t\t\t\t\t// \t\t\tparent.rendered = true;\r\n\t\t\t\t\t// \t\t\tcallback();\r\n\t\t\t\t\t// \t\t\t//\r\n\t\t\t\t\t// \t\t}\r\n\t\t\t\t\t// \t} else {\r\n\t\t\t\t\t// \t\t// Single image rendering\r\n\t\t\t\t\t// \t\tthat.img = img;\r\n\t\t\t\t\t// \t\tthat.rendered = true;\r\n\t\t\t\t\t// \t\t// Do drawing on rendering ended\r\n\t\t\t\t\t// \t\tcallback();\r\n\t\t\t\t\t// \t}\r\n\t\t\t\t\t// \tparent.rendering = false;\r\n\r\n\t\t\t\t\t// };\r\n\t\t\t\t\t// img.src = canvas.toDataURL();\r\n\t\t\t\t\tparent.width = viewport.width;\r\n\t\t\t\t\tparent.height = viewport.height;\r\n\r\n\t\t\t\t\tif (options.controls.filmStrip) {\r\n\t\t\t\t\t\tvar item = context.getImageData( 0, 0, viewport.width, viewport.height);\r\n\t\t\t\t\t\titem.pageNum = pageNum;\r\n\t\t\t\t\t\tparent.data.push(item);\r\n\t\t\t\t\t\tif (parent.data.length == options.controls.totalPage) {\r\n\t\t\t\t\t\t\t// Do sorting of all pictures\r\n\t\t\t\t\t\t\tparent.data.sort( function(objA, objB) {\r\n\t\t\t\t\t\t\t\treturn objA.pageNum - objB.pageNum;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Do drawing on rendering ended\r\n\t\t\t\t\t\t\tparent.rendered = true;\r\n\t\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t\t\tparent.rendering = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthat.data = context.getImageData(0,0,viewport.width,viewport.height);\r\n\t\t\t\t\t\tthat.rendered = true;\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t\tparent.rendering = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.refresh = function() {\r\n\t\t\t\tif (that._pdfDoc == null) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (parent.rendering) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthat.rendered = false;\r\n\t\t\t\tif (options.controls.filmStrip) {\r\n\t\t\t\t\tvar p = 1;\r\n\t\t\t\t\tvar promises = [];\r\n\t\t\t\t\tthat.data = [];\r\n\t\t\t\t\tfor (var p = 1; p <= options.controls.totalPage; p++) {\r\n\t\t\t\t\t\tpromises.push( that._pdfDoc.getPage(p) );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthat.$q.all(promises).then(function(pages) {\r\n\t\t\t\t\t\tfor (var p =0; p<pages.length; p++) {\r\n\t\t\t\t\t\t\trenderPage(that, pages[p].pageIndex, pages[p]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (that.currentPage != that.options.controls.numPage) {\r\n\t\t\t\t\t\tthat._pdfDoc.getPage(that.options.controls.numPage).then(function(page) {\r\n\t\t\t\t\t\t\trenderPage(that, that.options.controls.numPage, page);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trenderPage(that, that.options.controls.numPage, page);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.reader.onload = function() {\r\n\t\t\tvar data = new Uint8Array(that.reader.result);\r\n\t\t\tPDFJS.getDocument({data : data}).then(function(_pdfDoc) {\r\n\t\t\t\tthat._pdfDoc = _pdfDoc;\r\n\t\t\t\toptions.controls.totalPage = _pdfDoc.numPages;\r\n\t\t\t\toptions.controls.numPage = 1;\r\n\t\t\t\tthat._pdfDoc.getMetadata().then(function(data) {\r\n\t\t\t\t\toptions.info = data.info;\r\n\t\t\t\t\toptions.info.metadata = data.metadata;\r\n\t\t\t\t});\r\n\t\t\t\tthat.refresh();\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.reader.readAsArrayBuffer(data);\r\n\t\treturn this;\r\n\t},\r\n\r\n\ttiffReader : function(data, options, callback) {\r\n\t\tif (options.controls.toolbar) {\r\n\t\t\toptions.controls.image = true;\r\n\t\t\toptions.controls.sound = false;\r\n\t\t}\r\n\t\tthis.reader = new FileReader();\r\n\t\tvar that = this;\r\n\t\tthat.rendered = false;\r\n\t\tthat.tiff = null;\r\n\t\tthat.img = null;\r\n\t\tthat.data = null;\r\n\t\tthat.width = -1;\r\n\t\tthat.height = -1;\r\n\t\tthat.options = options;\r\n\t\tthat.images = [];\r\n\t\tthat.currentPage = -1;\r\n\t\tthat.isZoom = true;\r\n\t\tthis.refresh = function() {\r\n\t\t\tif (that.reader.result==undefined)\r\n\t\t\t\treturn;\r\n\t\t\tif (that.tiff == null) {\r\n\t\t\t\tthat.tiff = new Tiff( {buffer : that.reader.result});\r\n\t\t\t\tthat.options.controls.totalPage = that.tiff.countDirectory();\r\n\t\t\t\tthat.options.controls.numPage = 1;\r\n\t\t\t\tthat.options.info = {\r\n\t\t\t\t\twidth : that.tiff.width(),\r\n\t\t\t\t\theight : that.tiff.height(),\r\n\t\t\t\t\tcompression : that.tiff.getField(Tiff.Tag.COMPRESSION),\r\n\t\t\t\t\tdocument : that.tiff.getField(Tiff.Tag.DOCUMENTNAME),\r\n\t\t\t\t\tdescription : that.tiff.getField(Tiff.Tag.IMAGEDESCRIPTION),\r\n\t\t\t\t\torientation : that.tiff.getField(Tiff.Tag.ORIENTATION),\r\n\t\t\t\t\txresolution : that.tiff.getField(Tiff.Tag.XRESOLUTION),\r\n\t\t\t\t\tyresolution : that.tiff.getField(Tiff.Tag.YRESOLUTION)\r\n\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// Limit page number if upper\r\n\t\t\tif (that.options.controls.numPage > that.options.controls.totalPage) {\r\n\t\t\t\tthat.options.controls.numPage = that.options.controls.totalPage;\r\n\t\t\t}\r\n\t\t\t// Set to correct page\r\n\t\t\tif (that.options.controls.filmStrip) {\r\n\t\t\t\tthat.images = [];\r\n\t\t\t\tfor(var p=0; p < that.tiff.countDirectory(); p++) {\r\n\t\t\t\t\tthat.tiff.setDirectory(p);\r\n\t\t\t\t\t// Set only first page @TODO\r\n\t\t\t\t\tif (p==0) {\r\n\t\t\t\t\t\tthat.width = that.tiff.width();\r\n\t\t\t\t\t\tthat.height = that.tiff.height();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthat.images[p] = new Image();\r\n\t\t\t\t\tthat.images[p].onload = function() {\r\n\t\t\t\t\t\tif (that.images.length == 1) {\r\n\t\t\t\t\t\t\tthat.img = that.images[0];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t\tthat.rendered = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthat.images[p].src = that.tiff.toDataURL();\r\n\t\t\t\t\tthat.images[p].pageNum = p;\r\n\t\t\t\t\t//that.currentPage = that.options.controls.numPage;\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\tif (that.currentPage != that.options.controls.numPage) {\r\n\t\t\t\t\tthat.tiff.setDirectory(that.options.controls.numPage-1);\r\n\t\t\t\t\tthat.width = that.tiff.width();\r\n\t\t\t\t\tthat.height = that.tiff.height();\r\n\t\t\t\t\tthat.img = new Image();\r\n\t\t\t\t\tthat.img.onload = function() {\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t\tthat.rendered = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthat.img.src = that.tiff.toDataURL();\r\n\t\t\t\t\tthat.currentPage = that.options.controls.numPage;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.reader.onload = function() {\r\n\t\t\tif (that.tiff != null) {\r\n\t\t\t\tthat.tiff.close();\r\n\t\t\t\tthat.tiff = null;\r\n\t\t\t}\r\n\t\t\tTiff.initialize({TOTAL_MEMORY:16777216*5});\r\n\t\t\tthat.refresh();\r\n\t\t};\r\n\t\tthis.reader.readAsArrayBuffer(data);\r\n\t\treturn this;\r\n\t},\r\n\r\n\timageReader : function(data, options, callback) {\r\n\t\tif (options.controls.toolbar) {\r\n\t\t\toptions.controls.image = true;\r\n\t\t\toptions.controls.sound = false;\r\n\t\t}\r\n\t\tthis.reader = new FileReader();\r\n\t\tvar that = this;\r\n\t\tthat.img = new Image();\r\n\t\tthat.img.onload = function() {\r\n\t\t\tthat.width = that.img.width;\r\n\t\t\tthat.height = that.img.height;\r\n\t\t\tcallback();\r\n\t\t\tthat.rendered = true;\r\n\t\t}\r\n\t\tthat.data = null;\r\n\t\tthat.width = -1;\r\n\t\tthat.height = -1;\r\n\t\toptions.info = {};\r\n\t\tthat.isZoom = true;\r\n\t\tthat.rendered = false;\r\n\t\tthis.reader.onload = function() {\r\n\t\t\tthat.img.src = that.reader.result;\r\n\t\t};\r\n\t\tif (typeof(data) === 'string') {\r\n\t\t\tthat.img.src = data;\r\n\t\t} else {\r\n\t\t\tthis.reader.readAsDataURL(data);\r\n\t\t}\r\n\t\t// PNG or JPEG are one page only\r\n\t\toptions.controls.totalPage = 1;\r\n\t\toptions.controls.numPage = 1;\r\n\t\tthis.refresh = function() {\r\n\t\t\t// do nothing\r\n\t\t};\r\n\t\treturn this;\r\n\t},\r\n\r\n\tmpegReader : function(data, options, callback) {\r\n\r\n\t},\r\n\r\n\twavReader : function(data, options, callback) {\r\n\t\tif (options.controls.toolbar) {\r\n\t\t\toptions.controls.image = false;\r\n\t\t\toptions.controls.sound = true;\r\n\t\t}\r\n\r\n\t\tthis.reader = new FileReader();\r\n\t\tvar that = this;\r\n\t\tvar ctx = options.ctx;\r\n\t\tthis.width = ctx.canvas.width;\r\n\t\tthis.height = ctx.canvas.height;\r\n\t\ttry {\r\n\t\t\t// Fix up for prefixing\r\n\t\t\t$window.AudioContext = $window.AudioContext || $window.webkitAudioContext || $window.mozAudioContext || $window.msAudioContext;\r\n\t\t\t$window.requestAnimationFrame = $window.requestAnimationFrame || $window.webkitRequestAnimationFrame || $window.mozRequestAnimationFrame || $window.msRequestAnimationFrame;\r\n\t\t\t$window.cancelAnimationFrame = $window.cancelAnimationFrame || $window.webkitCancelAnimationFrame || $window.mozCancelAnimationFrame || $window.msCancelAnimationFrame;\r\n\t\t\tvar adctx = new AudioContext();\r\n\t\t\t// update options context audio\r\n\t\t\tthis.reader.onload = function() {\r\n\t\t\t\t// creates a sound source\r\n\t\t\t\tadctx.decodeAudioData( that.reader.result , function(buffer) {\r\n\t\t\t\t\tvar gradient = ctx.createLinearGradient(0,0,0,that.height);\r\n\t\t\t\t\tgradient.addColorStop(1,'#000000');\r\n\t\t\t\t\tgradient.addColorStop(0.75,'#ff0000');\r\n\t\t\t\t\tgradient.addColorStop(0.25,'#ffff00');\r\n\t\t\t\t\tgradient.addColorStop(0,'#ffffff');\r\n\t\t\t\t\t// setup a javascript node\r\n\t\t\t\t\tvar javascriptNode = adctx.createScriptProcessor(2048, 1, 1);\r\n\t\t\t\t\tvar source = adctx.createBufferSource();\r\n\t\t\t\t\toptions.adsrc = source;\r\n\t\t\t\t\t// tell the source which sound to play\r\n\t\t\t\t\tsource.buffer = buffer;\r\n\t\t\t\t\t// setup a analyzer\r\n\t\t\t\t\tvar analyser = adctx.createAnalyser();\r\n\t\t\t\t\tanalyser.smoothingTimeConstant = 0.3;\r\n\t\t\t\t\tanalyser.fftSize = 512;\r\n\t\t\t\t\t// connect the source to the analyser\r\n\t\t\t\t\tsource.connect(analyser);\r\n\t\t\t\t\t// we use the javascript node to draw at a specific interval.\r\n\t\t\t\t\tanalyser.connect(javascriptNode);\r\n\t\t\t\t\tjavascriptNode.onaudioprocess = function() {\r\n\t\t\t\t\t    // get the average for the first channel\r\n\t\t\t\t\t    var array =  new Uint8Array(analyser.frequencyBinCount);\r\n\t\t\t\t\t    analyser.getByteFrequencyData(array);\r\n\t\t\t\t\t    // clear the current state\r\n\t\t\t\t\t    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n\t\t\t\t\t    // set the fill style\r\n\t\t\t\t\t    ctx.fillStyle=gradient;\r\n\t\t\t\t\t\tfor ( var i = 0; i < (array.length); i++ ){\r\n\t\t\t\t\t        var value = array[i];\r\n\t\t\t\t\t        ctx.fillRect(i*5,that.height-value,3,that.height);\r\n\t\t\t\t\t    }\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// connect to destination, else it isn't called\r\n\t\t\t\t\tjavascriptNode.connect(adctx.destination);\r\n\t\t\t\t\t// connect the source to the context's destination (the speakers)\r\n\t\t\t\t\tsource.connect(adctx.destination);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\tthis.reader.readAsArrayBuffer(data);\r\n\t\t}\r\n\t\tcatch(e) {\r\n\t\t}\r\n\t},\r\n\t// Runs during compile\r\n\tCreateReader : function(mimeType, obj) {\r\n\t\tvar reader = null;\r\n\r\n\t\tif (mimeType == \"\") {\r\n\t\t\tmimeType = this.GuessMimeType(obj);\r\n\t\t}\r\n\r\n\t\tswitch(mimeType.toLowerCase()) {\r\n\t\t\tcase \"image/tif\" :\r\n\t\t\tcase \"image/tiff\" :reader = { create : this.tiffReader }; break;\r\n\t\t\tcase \"application/pdf\" : reader = { create : this.pdfReader }; break;\r\n\t\t\tcase \"image/png\" :\r\n\t\t\tcase \"image/jpeg\" : reader = { create : this.imageReader}; break;\r\n\t\t\tcase \"audio/x-wav\" :\r\n\t\t\tcase \"audio/wav\" :\r\n\t\t\tcase \"audio/x-ogg\" :\r\n\t\t\tcase \"audio/ogg\" : reader = { create : this.wavReader}; break;\r\n\t\t\tcase \"audio/x-mpeg\" :\r\n\t\t\tcase \"audio/mpeg\" : reader = { create : this.mpegReader}; break;\r\n\t\t};\r\n\t\treturn reader;\r\n\t},\r\n\tIsSupported : function(mimeType) {\r\n\t\treturn (this.mimetype.indexOf(mimeType) != -1);\r\n\t},\r\n\tGuessMimeType : function(obj) {\r\n\t\t// try to guess mime type if not available\r\n\t\tvar mimeType = \"\";\r\n\t\tif (obj.type == \"\") {\r\n\t\t\tvar fileName = obj.name;\r\n\t\t\tmimeType = \"image/\"+fileName.substring(fileName.indexOf('.')+1);\r\n\t\t}\r\n\t\treturn mimeType.toLowerCase();\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/FormatReader.js"],"sourceRoot":""}